<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GÃ¼nlÃ¼k Kar Takip</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.0.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.0.0/firebase-database-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .input-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, button { padding: 8px; margin: 5px; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #007bff; color: white; cursor: pointer; }
        button:hover { background: #0056b3; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; }
        .chart-container { width: 100%; height: 400px; margin: 20px 0; }
        .tabs { display: flex; margin-bottom: 20px; }
        .tab { padding: 10px 20px; background: #e9ecef; margin-right: 5px; cursor: pointer; border-radius: 5px 5px 0 0; }
        .tab.active { background: #007bff; color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .error { color: red; font-size: 12px; }
        .success { color: green; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>GÃ¼nlÃ¼k Kar Takip Paneli</h1>
        <!-- Ayarlar -->
        <div class="section">
            <h3>GÃ¼nlÃ¼k Hedef</h3>
            <input type="number" id="dailyTarget" placeholder="50" style="width:80px;"> TL
            <button onclick="saveSettings()">Kaydet</button>
            <div id="settingsStatus"></div>
        </div>

        <!-- Kar GiriÅŸi -->
        <div class="section">
            <h3>BugÃ¼nkÃ¼ Kar GiriÅŸi</h3>
            <div class="input-group">
                <label>Kar MiktarÄ± (TL):</label>
                <input type="number" id="todayProfit" step="0.01" placeholder="0">
                <button onclick="saveTodayProfit()">Kaydet</button>
            </div>
            <div id="todayStatus"></div>
        </div>

        <!-- Analiz Sekmeleri -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('overview')">Genel BakÄ±ÅŸ</div>
            <div class="tab" onclick="showTab('charts')">Grafikler</div>
            <div class="tab" onclick="showTab('predictions')">Tahminler</div>
        </div>

        <!-- Genel BakÄ±ÅŸ -->
        <div id="overview" class="tab-content active">
            <div class="stats" id="statsContainer"></div>
        </div>

        <!-- Grafikler -->
        <div id="charts" class="tab-content">
            <div class="chart-container">
                <canvas id="profitChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="monthlyChart"></canvas>
            </div>
        </div>

        <!-- Tahminler -->
        <div id="predictions" class="tab-content">
            <div class="section">
                <h4>Ä°leriye DÃ¶nÃ¼k Tahminler</h4>
                <div id="predictionResults"></div>
            </div>
        </div>
    </div>

    <script>

        const firebaseConfig = {
            apiKey: "AIzaSyAIGzwmEB9F7K7KQzsEU5etVWejZ3oSluc",
            authDomain: "paralayici.firebaseapp.com",
            projectId: "paralayici",
            storageBucket: "paralayici.firebasestorage.app",
            messagingSenderId: "980843550614",
            appId: "1:980843550614:web:93dd5bda4ddc377b20efb7"
        };

        let db = null;
        let profitData = {};
        let settings = { dailyTarget: 50 };

        // Sayfa yÃ¼klendiÄŸinde otomatik baÅŸlat
        window.onload = function() { initializeApp(); };

        function initializeApp() {
            try {
                if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
                db = firebase.database();
                showStatus('Firebase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±! ğŸŸ¢', 'success');
                loadData();
            } catch (error) {
                console.error('Firebase baÄŸlantÄ± hatasÄ±:', error);
                showStatus('Firebase baÄŸlantÄ± hatasÄ±! LÃ¼tfen config bilgilerini kontrol edin. ğŸ”´', 'error');
            }
        }

        function showStatus(message, type, elementId = null) {
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            const statusHTML = `<span class="${className}">${message}</span>`;
            
            if (elementId) {
                document.getElementById(elementId).innerHTML = statusHTML;
            } else {
                // Genel status gÃ¶sterimi iÃ§in container oluÅŸtur
                if (!document.getElementById('generalStatus')) {
                    const statusDiv = document.createElement('div');
                    statusDiv.id = 'generalStatus';
                    statusDiv.style.cssText = 'position:fixed;top:10px;right:10px;background:white;padding:10px;border-radius:5px;box-shadow:0 2px 10px rgba(0,0,0,0.3);z-index:1000;';
                    document.body.appendChild(statusDiv);
                }
                document.getElementById('generalStatus').innerHTML = statusHTML;
                setTimeout(() => { document.getElementById('generalStatus').innerHTML = ''; }, 3000);
            }
        }

        function loadData() {
            if (!db) {
                showStatus('Database baÄŸlantÄ±sÄ± yok! ğŸ”´', 'error');
                return;
            }
            
            showStatus('Veriler yÃ¼kleniyor... â³', 'info');
            
            // AyarlarÄ± yÃ¼kle
            db.ref('settings').once('value', (snapshot) => {
                if (snapshot.exists()) {
                    settings = snapshot.val();
                    document.getElementById('dailyTarget').value = settings.dailyTarget;
                    showStatus('Ayarlar yÃ¼klendi âœ“', 'success');
                } else {
                    db.ref('settings').set(settings).then(() => {
                        document.getElementById('dailyTarget').value = settings.dailyTarget;
                        showStatus('VarsayÄ±lan ayarlar oluÅŸturuldu âœ“', 'success');
                    }).catch(() => {
                        showStatus('Ayarlar oluÅŸturulamadÄ±! ğŸ”´', 'error');
                    });
                }
            }).catch(() => {
                showStatus('Ayarlar yÃ¼klenemedi! ğŸ”´', 'error');
            });
            
            // Kar verilerini yÃ¼kle
            db.ref('profits').once('value', (snapshot) => {
                profitData = snapshot.val() || {};
                const dataCount = Object.keys(profitData).length;
                updateDisplay();
                checkTodayStatus();
                
                if (dataCount > 0) {
                    showStatus(`${dataCount} gÃ¼nlÃ¼k veri yÃ¼klendi âœ“`, 'success');
                } else {
                    showStatus('HenÃ¼z kar verisi yok. Ä°lk giriÅŸinizi yapÄ±n! ğŸ“Š', 'info');
                }
            }).catch(() => {
                showStatus('Kar verileri yÃ¼klenemedi! ğŸ”´', 'error');
            });
        }

        function saveSettings() {
            if (!db) {
                showStatus('Database baÄŸlantÄ±sÄ± yok! ğŸ”´', 'error', 'settingsStatus');
                return;
            }
            
            const target = parseFloat(document.getElementById('dailyTarget').value);
            
            if (!target || target <= 0) {
                showStatus('GeÃ§erli bir hedef tutarÄ± girin! âš ï¸', 'error', 'settingsStatus');
                return;
            }
            
            settings.dailyTarget = target;
            showStatus('Kaydediliyor... â³', 'info', 'settingsStatus');
            
            db.ref('settings').set(settings).then(() => {
                showStatus(`GÃ¼nlÃ¼k hedef ${target} TL olarak kaydedildi! âœ“`, 'success', 'settingsStatus');
                updateDisplay(); // Grafikleri gÃ¼ncelle
            }).catch((error) => {
                showStatus('Ayarlar kaydedilemedi! ğŸ”´', 'error', 'settingsStatus');
                console.error('Ayar kaydetme hatasÄ±:', error);
            });
        }

        function saveTodayProfit() {
            if (!db) {
                showStatus('Database baÄŸlantÄ±sÄ± yok! ğŸ”´', 'error', 'todayStatus');
                return;
            }
            
            const today = new Date().toISOString().split('T')[0];
            const profit = parseFloat(document.getElementById('todayProfit').value);
            
            if (isNaN(profit) || profit < 0) {
                showStatus('GeÃ§erli bir kar tutarÄ± girin! (0 veya pozitif deÄŸer) âš ï¸', 'error', 'todayStatus');
                return;
            }
            
            if (profitData[today]) {
                const existingProfit = profitData[today];
                showStatus(`BugÃ¼n iÃ§in zaten ${existingProfit} TL kaydedilmiÅŸ! GÃ¼nde sadece 1 giriÅŸ yapabilirsiniz. ğŸš«`, 'error', 'todayStatus');
                return;
            }
            
            showStatus('Kaydediliyor... â³', 'info', 'todayStatus');
            
            profitData[today] = profit;
            
            db.ref('profits').set(profitData).then(() => {
                showStatus(`${profit} TL bugÃ¼nkÃ¼ kar olarak kaydedildi! ğŸ’°`, 'success', 'todayStatus');
                document.getElementById('todayProfit').value = '';
                updateDisplay();
                
                // Hedef kontrolÃ¼
                if (profit >= settings.dailyTarget) {
                    setTimeout(() => {
                        showStatus(`ğŸ‰ Tebrikler! GÃ¼nlÃ¼k hedefi aÅŸtÄ±nÄ±z! (+${(profit - settings.dailyTarget).toFixed(2)} TL)`, 'success');
                    }, 1000);
                } else {
                    setTimeout(() => {
                        showStatus(`Hedefe ${(settings.dailyTarget - profit).toFixed(2)} TL kaldÄ± ğŸ“ˆ`, 'info');
                    }, 1000);
                }
            }).catch((error) => {
                showStatus('Kar verisi kaydedilemedi! ğŸ”´', 'error', 'todayStatus');
                console.error('Kar kaydetme hatasÄ±:', error);
            });
        }

        function updateDisplay() {
            try {
                updateStats();
                updateCharts();
                updatePredictions();
                showStatus('Grafikler gÃ¼ncellendi ğŸ“Š', 'success');
            } catch (error) {
                showStatus('Grafik gÃ¼ncellemesinde hata oluÅŸtu! ğŸ”´', 'error');
                console.error('Display gÃ¼ncelleme hatasÄ±:', error);
            }
        }

        function updateStats() {
            const dates = Object.keys(profitData).sort();
            const values = dates.map(date => profitData[date]);
            const total = values.reduce((a, b) => a + b, 0);
            const avg = values.length > 0 ? total / values.length : 0;
            const today = new Date().toISOString().split('T')[0];
            const todayProfit = profitData[today] || 0;
            
            const last7Days = dates.slice(-7).map(date => profitData[date]);
            const weeklyAvg = last7Days.length > 0 ? last7Days.reduce((a, b) => a + b, 0) / last7Days.length : 0;
            
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const monthlyData = dates.filter(date => {
                const d = new Date(date);
                return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
            }).map(date => profitData[date]);
            const monthlyTotal = monthlyData.reduce((a, b) => a + b, 0);
            
            const targetSuccess = values.filter(v => v >= settings.dailyTarget).length;
            const targetRate = values.length > 0 ? (targetSuccess / values.length * 100) : 0;

            document.getElementById('statsContainer').innerHTML = `
                <div class="stat-card"><h4>Toplam Kar</h4><p>${total.toFixed(2)} TL</p></div>
                <div class="stat-card"><h4>GÃ¼nlÃ¼k Ortalama</h4><p>${avg.toFixed(2)} TL</p></div>
                <div class="stat-card"><h4>BugÃ¼nkÃ¼ Kar</h4><p>${todayProfit.toFixed(2)} TL</p></div>
                <div class="stat-card"><h4>HaftalÄ±k Ortalama</h4><p>${weeklyAvg.toFixed(2)} TL</p></div>
                <div class="stat-card"><h4>Bu Ay Toplam</h4><p>${monthlyTotal.toFixed(2)} TL</p></div>
                <div class="stat-card"><h4>Hedef BaÅŸarÄ± OranÄ±</h4><p>%${targetRate.toFixed(1)}</p></div>
                <div class="stat-card"><h4>Toplam GÃ¼n</h4><p>${values.length} gÃ¼n</p></div>
                <div class="stat-card"><h4>GÃ¼nlÃ¼k Hedef</h4><p>${settings.dailyTarget} TL</p></div>
            `;
        }

        function updateCharts() {
            const dates = Object.keys(profitData).sort().slice(-30);
            const values = dates.map(date => profitData[date]);
            
            // GÃ¼nlÃ¼k grafik
            const dailyCtx = document.getElementById('profitChart').getContext('2d');
            if (window.dailyChart) { window.dailyChart.destroy(); }
            window.dailyChart = new Chart(dailyCtx, { type: 'line', data: { labels: dates.map(d => d.split('-').slice(1).join('/')), datasets: [{ label: 'GÃ¼nlÃ¼k Kar (TL)', data: values, borderColor: '#007bff', backgroundColor: 'rgba(0,123,255,0.1)', tension: 0.4 }, { label: 'Hedef', data: new Array(dates.length).fill(settings.dailyTarget), borderColor: '#dc3545', borderDash: [5, 5], fill: false }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'Son 30 GÃ¼n Kar Trendi' } } } });
            
            // AylÄ±k Ã¶zet
            const monthlyData = {};
            Object.keys(profitData).forEach(date => {
                const monthKey = date.substring(0, 7);
                monthlyData[monthKey] = (monthlyData[monthKey] || 0) + profitData[date];
            });
            
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            if (window.monthlyChart) { window.monthlyChart.destroy(); }
            window.monthlyChart = new Chart(monthlyCtx, { type: 'bar', data: { labels: Object.keys(monthlyData).map(m => m.split('-').join('/')), datasets: [{ label: 'AylÄ±k Toplam (TL)', data: Object.values(monthlyData), backgroundColor: '#28a745' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { title: { display: true, text: 'AylÄ±k Kar ToplamlarÄ±' } } } });
        }

        function updatePredictions() {
            const values = Object.values(profitData);
            if (values.length < 3) {
                document.getElementById('predictionResults').innerHTML = '<p>Tahmin iÃ§in daha fazla veri gerekli (en az 3 gÃ¼n)</p>';
                return;
            }
            
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            const last7Avg = values.slice(-7).reduce((a, b) => a + b, 0) / Math.min(7, values.length);
            
            const monthlyPrediction = avg * 30;
            const yearlyPrediction = avg * 365;
            const targetDays = Math.ceil(1000 / avg);
            
            const trend = last7Avg > avg ? 'artÄ±ÅŸ' : last7Avg < avg ? 'azalÄ±ÅŸ' : 'sabit';
            const trendEmoji = trend === 'artÄ±ÅŸ' ? 'ğŸ“ˆ' : trend === 'azalÄ±ÅŸ' ? 'ğŸ“‰' : 'â¡ï¸';
            
            document.getElementById('predictionResults').innerHTML = `
                <div class="stats">
                    <div class="stat-card"><h4>Bu GidiÅŸle AylÄ±k</h4><p>${monthlyPrediction.toFixed(0)} TL</p></div>
                    <div class="stat-card"><h4>Bu GidiÅŸle YÄ±llÄ±k</h4><p>${yearlyPrediction.toFixed(0)} TL</p></div>
                    <div class="stat-card"><h4>1000 TL Ä°Ã§in</h4><p>${targetDays} gÃ¼n gerekli</p></div>
                    <div class="stat-card"><h4>Trend ${trendEmoji}</h4><p>Son hafta ${trend}</p></div>
                </div>
                <div class="section">
                    <h4>DetaylÄ± Analiz</h4>
                    <p><strong>GÃ¼nlÃ¼k ortalama:</strong> ${avg.toFixed(2)} TL</p>
                    <p><strong>Son hafta ortalama:</strong> ${last7Avg.toFixed(2)} TL</p>
                    <p><strong>Hedef baÅŸarÄ± durumu:</strong> ${avg >= settings.dailyTarget ? 'âœ… Hedef Ã¼stÃ¼nde' : 'âŒ Hedef altÄ±nda'}</p>
                    <p><strong>Hedeften fark:</strong> ${(avg - settings.dailyTarget).toFixed(2)} TL</p>
                </div>
            `;
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function checkTodayStatus() {
            const today = new Date().toISOString().split('T')[0];
            if (profitData[today]) {
                const todayProfit = profitData[today];
                const status = todayProfit >= settings.dailyTarget ? 
                    `âœ… BugÃ¼n ${todayProfit} TL kaydettiniz (Hedef aÅŸÄ±ldÄ±!)` : 
                    `ğŸ“Š BugÃ¼n ${todayProfit} TL kaydettiniz (Hedefe ${(settings.dailyTarget - todayProfit).toFixed(2)} TL kaldÄ±)`;
                showStatus(status, 'success', 'todayStatus');
            } else {
                showStatus('BugÃ¼n henÃ¼z kar giriÅŸi yapmadÄ±nÄ±z ğŸ“', 'info', 'todayStatus');
            }
        }
    </script>
</body>
</html>
